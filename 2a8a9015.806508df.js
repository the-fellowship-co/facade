(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{113:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"metadata",(function(){return d})),t.d(n,"rightToc",(function(){return c})),t.d(n,"default",(function(){return s}));var r=t(2),a=t(6),i=(t(0),t(145)),o={id:"working_with_edges",title:"Working with edges",sidebar_label:"Working with edges"},d={id:"bylding_backends/working_with_edges",isDocsHomePage:!1,title:"Working with edges",description:"Gate",source:"@site/docs/bylding_backends/working_with_edges.md",permalink:"/docs/bylding_backends/working_with_edges",editUrl:"https://github.com/the-fellowship-co/facade/edit/master/docs/bylding_backends/working_with_edges.md",sidebar_label:"Working with edges",sidebar:"someSidebar",previous:{title:"Communicating between blocks",permalink:"/docs/bylding_backends/communicating_between_blocks"},next:{title:"Deploying and testing gate",permalink:"/docs/bylding_backends/deploying_and_testing_gate"}},c=[{value:"Gate",id:"gate",children:[{value:"Structure of a gate",id:"structure-of-a-gate",children:[]}]},{value:"Edge",id:"edge",children:[{value:"Creating edges",id:"creating-edges",children:[]},{value:"Joining models",id:"joining-models",children:[]}]}],l={rightToc:c};function s(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"gate"},"Gate"),Object(i.b)("p",null,"Gate is a single GraphQL based API gateway for different frontends like web, mobile and desktop. GraphQL eliminates the need for having a separate gateway for each frontend. GraphQL let's you customize your response by returning only the data you ask. Gate is a collection of edges."),Object(i.b)("p",null,"You can learn more about GraphQL in ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://graphql.org/"}),"GraphQL guide")),Object(i.b)("h3",{id:"structure-of-a-gate"},"Structure of a gate"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sh"}),"gate/\n\u251c\u2500\u2500 Gemfile\n\u2514\u2500\u2500 edges\n    \u2514\u2500\u2500 user_edge.rb\n    \u2514\u2500\u2500 stock_edge.rb\n    \u2514\u2500\u2500 order_edge.rb\n    \u2514\u2500\u2500 payment_edge.rb\n    \u2514\u2500\u2500 shipping_edge.rb\n")),Object(i.b)("h2",{id:"edge"},"Edge"),Object(i.b)("p",null,"Edge is a layer between your frontends and blocks. Edge can be used to create powerful APIs aggregating multiple interface methods from different blocks. For example, to power the order summary UI we need to aggregate ",Object(i.b)("inlineCode",{parentName:"p"},"get_order")," from order block, ",Object(i.b)("inlineCode",{parentName:"p"},"get_payment")," from payment block and ",Object(i.b)("inlineCode",{parentName:"p"},"shipping_status")," from shipping block based on ",Object(i.b)("inlineCode",{parentName:"p"},"order_id"),". Our ",Object(i.b)("inlineCode",{parentName:"p"},"join")," markup  simplifies aggregations further by eliminating a need to write a separate method for each complex API."),Object(i.b)("h3",{id:"creating-edges"},"Creating edges"),Object(i.b)("p",null,"Use ",Object(i.b)("inlineCode",{parentName:"p"},"byld gate expose [block-name]")," to generate edges for each ",Object(i.b)("inlineCode",{parentName:"p"},"Byld::Model")," in the block. You could add additional query and mutations using the interface markup\n",Object(i.b)("inlineCode",{parentName:"p"},"inf(RequestType) {ReturnType}")," over it. Use ",Object(i.b)("inlineCode",{parentName:"p"},"!")," to end the methods to mark them as mutations."),Object(i.b)("p",null,"You can also use ",Object(i.b)("inlineCode",{parentName:"p"},"Byld::Edge")," to create custom egdes and add your own methods to aggregate different interface methods across blocks."),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-ruby"}),"class OrderEdge < Byld::Edge\n  include Orders\n\n  inf(ID) {Order}\n  def get_order(id)\n    Order.client.get(id)\n  end\n\n  inf(CreateOrderReq) {Order}\n  def create_order!(req)\n    Order.client.create!(req)\n  end\n\n  inf(UpdateOrderReq) {Order}\n  def update_order!(req)\n    Order.client.update!(req)\n  end\n\n  inf(ID) {Order}\n  def delete_order!(id)\n    Order.client.delete!(id)\n  end\nend\n")),Object(i.b)("h3",{id:"joining-models"},"Joining models"),Object(i.b)("p",null,"Use join markup ",Object(i.b)("inlineCode",{parentName:"p"},"join [ReturnType]")," to aggregate models across different blocks, doing that would include the joining model as part of the parent model. For instance ",Object(i.b)("inlineCode",{parentName:"p"},"join User")," allows you to get customer model as part of order model. Now, you can get any customer fields in response along with the order."),Object(i.b)("p",null,"Below ",Object(i.b)("inlineCode",{parentName:"p"},"OrderEdge")," is joined with ",Object(i.b)("inlineCode",{parentName:"p"},"User"),", ",Object(i.b)("inlineCode",{parentName:"p"},"Payment"),", ",Object(i.b)("inlineCode",{parentName:"p"},"Shipping")," to power the order summary UI."),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-ruby"}),"class OrderEdge < Byld::Edge\n  include Order\n  include Identity\n\n  ...\n\n  join User\n  def customer(order)\n    User.client.get(order.user_id)\n  end\n\n  join Payment\n  def payment(order)\n    Payment.client.get(order.payment_id)\n  end\n\n  join Shipping\n  def delivery(order)\n    Shipping.client.get(order.shipping_id)\n  end\n\nend\n")),Object(i.b)("p",null,"Now to from the order summary UI, the following GraphQL query can be issued. Similarly, multiple complex APIs can be powered without creating a separate method."),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-graphql"}),'query {\n  getOrder(id: "z3dsbjn3223") {\n    id\n    totalPrice\n    lineItems {\n      qty\n      totalPrice\n        product {\n          title\n        }\n      }\n      customer {\n        firstName\n        address {\n          street\n          city\n        }\n      }\n      payment {\n        transaction_status\n      }\n      delivery {\n        shipping_status\n        estimated_delivery\n      }\n  }\n}\n')))}s.isMDXComponent=!0},145:function(e,n,t){"use strict";t.d(n,"a",(function(){return p})),t.d(n,"b",(function(){return u}));var r=t(0),a=t.n(r);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function d(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)t=i[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=a.a.createContext({}),s=function(e){var n=a.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):d(d({},n),e)),t},p=function(e){var n=s(e.components);return a.a.createElement(l.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},g=a.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),p=s(t),g=r,u=p["".concat(o,".").concat(g)]||p[g]||b[g]||i;return t?a.a.createElement(u,d(d({ref:n},l),{},{components:t})):a.a.createElement(u,d({ref:n},l))}));function u(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=g;var d={};for(var c in n)hasOwnProperty.call(n,c)&&(d[c]=n[c]);d.originalType=e,d.mdxType="string"==typeof e?e:r,o[1]=d;for(var l=2;l<i;l++)o[l]=t[l];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,t)}g.displayName="MDXCreateElement"}}]);